(()=>{"use strict";var e=require("@babel/runtime-corejs3/core-js/instance/match-all"),t=require("@babel/runtime-corejs3/core-js-stable/instance/trim");const n=new Map;chrome.runtime.onInstalled.addListener(()=>{var e;chrome.contextMenus.removeAll(()=>{chrome.contextMenus.create({id:"pasteHuman",title:"Paste as Human",contexts:["editable"]}),chrome.contextMenus.create({id:"pasteHumanNormal",parentId:"pasteHuman",title:"Start Immediately",contexts:["editable"]}),chrome.contextMenus.create({id:"pasteHumanDelayed",parentId:"pasteHuman",title:"With Delayed Start (1s)",contexts:["editable"]}),chrome.contextMenus.create({id:"pasteHumanCustom",parentId:"pasteHuman",title:"Custom Text...",contexts:["editable"]}),chrome.contextMenus.create({id:"separator1",parentId:"pasteHuman",type:"separator",contexts:["editable"]}),chrome.contextMenus.create({id:"stopTyping",parentId:"pasteHuman",title:"Stop Current Typing",contexts:["editable"]})}),null===(e=chrome.commands)||void 0===e||null===(e=e.onCommand)||void 0===e||e.addListener(e=>{chrome.tabs.query({active:!0,currentWindow:!0},t=>{if(t[0])switch(e){case"paste-human":r(t[0].id,!1);break;case"paste-human-delayed":r(t[0].id,!0);break;case"stop-typing":c(t[0].id)}})})});const a="/offscreen.html";let o;async function s(){await async function(t){await async function(t){var n;const a=chrome.runtime.getURL(t);return(await e(n=self.clients).call(n)).some(e=>e.url===a)}(t)||(o?await o:(o=chrome.offscreen.createDocument({url:t,reasons:["CLIPBOARD"],justification:"The extension needs to read clipboard text in the background."}),await o,o=null))}(a);const t=await chrome.runtime.sendMessage({type:"get-clipboard-text"});return await chrome.offscreen.closeDocument(),t}async function r(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{let r=o;r||(r=await s()),r&&""!==t(r).call(r)||(r="This is a test of human-like typing functionality.",i("No clipboard text found, using default text","info"));const c=await chrome.tabs.sendMessage(e,{action:"startTyping",text:r,delayedStart:a});if(!c||!c.success)throw new Error((null==c?void 0:c.error)||"Unknown error occurred");n.set(e,c.sessionId),i(a?"Human typing will start in 1 second...":"Human typing started!","success")}catch(e){console.error("Error in handlePasteHuman:",e),e.message.includes("Could not establish connection")?i("Please refresh the page and try again","error"):e.message.includes("No active element")?i("Please click in a text field first","warning"):i("Error: ".concat(e.message),"error")}}async function c(e){try{const t=await chrome.tabs.sendMessage(e,{action:"stopTyping"});t&&t.success&&(n.delete(e),i("Typing stopped","info"))}catch(e){console.error("Error stopping typing:",e),i("Could not stop typing","error")}}function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";const n="human-typing-".concat(Date.now()),a={success:"icons/icon48.png",error:"icons/icon48.png",warning:"icons/icon48.png",info:"icons/icon48.png"}[t]||"icons/icon48.png";chrome.notifications.create(n,{type:"basic",iconUrl:a,title:"Human Typing",message:e,priority:"error"===t?2:1}),setTimeout(()=>{chrome.notifications.clear(n)},3e3)}chrome.contextMenus.onClicked.addListener(async(e,t)=>{switch(e.menuItemId){case"pasteHumanNormal":await r(t.id,!1);break;case"pasteHumanDelayed":await r(t.id,!0);break;case"pasteHumanCustom":await async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{const n=await chrome.windows.create({url:chrome.runtime.getURL("prompt.html"),type:"popup",width:400,height:200,focused:!0});chrome.storage.local.set({["prompt_".concat(n.id)]:{tabId:e,delayedStart:t,timestamp:Date.now()}})}catch(e){console.error("Error creating prompt window:",e),i("Could not open custom text prompt","error")}}(t.id,!1);break;case"stopTyping":await c(t.id)}}),chrome.runtime.onMessage.addListener((e,t,n)=>{switch(e.action){case"customTextSubmit":e.text&&e.context?(r(e.context.tabId,e.context.delayedStart,e.text),n({success:!0})):n({success:!1,error:"Invalid custom text data"});break;case"getClipboard":return s().then(e=>{n({success:!0,text:e})}).catch(e=>{n({success:!1,error:e.message})}),!0;default:n({success:!1,error:"Unknown action"})}}),chrome.tabs.onRemoved.addListener(e=>{n.delete(e)}),chrome.windows.onRemoved.addListener(e=>{chrome.storage.local.remove("prompt_".concat(e))}),setInterval(()=>{const e=Date.now();chrome.storage.local.get(null,t=>{Object.keys(t).forEach(n=>{n.startsWith("prompt_")&&t[n].timestamp&&e-t[n].timestamp>3e5&&chrome.storage.local.remove(n)})})},6e4)})();
//# sourceMappingURL=background.js.map